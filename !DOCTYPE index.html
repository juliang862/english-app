<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•´ë¦¬í¬í„° ì˜ì–´ í•™ìŠµ & í€´ì¦ˆ</title>
    
    <!-- PWA ì„¤ì • -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffd700">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="í•´ë¦¬í¬í„° ì˜ì–´">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2c1810 0%, #8b4513 50%, #daa520 100%);
            min-height: 100vh;
            padding: 10px;
            color: #333;
            touch-action: manipulation;
            /* PWAì—ì„œ í’€ìŠ¤í¬ë¦° ëŒ€ì‘ */
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            text-align: center;
        }

        .header {
            color: #ffd700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            position: sticky;
            top: 0;
            background: rgba(44, 24, 16, 0.9);
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .subtitle {
            font-size: 0.9em;
            color: #e6e6e6;
        }

        /* ì„¤ì¹˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .install-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.2em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255,107,107,0.3);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .install-btn:hover {
            transform: scale(1.1);
        }

        .install-btn.hidden {
            display: none;
        }

        .mode-indicator {
            background: linear-gradient(45deg, #dc143c, #ff6347);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            margin: 10px 0;
            font-size: 0.9em;
        }

        .progress {
            background: rgba(255,215,0,0.2);
            border-radius: 15px;
            padding: 3px;
            margin-bottom: 15px;
            border: 2px solid #daa520;
            height: 30px;
        }

        .progress-bar {
            background: linear-gradient(90deg, #8b0000, #dc143c);
            height: 100%;
            border-radius: 12px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8em;
        }

        /* í•™ìŠµ ëª¨ë“œ ì¹´ë“œ */
        .study-card {
            background: linear-gradient(145deg, #f8f4e6, #fff8dc);
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            padding: 25px 15px;
            margin: 15px 0;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #daa520;
            position: relative;
        }

        .study-card:active {
            transform: scale(0.98);
        }

        .study-card.flipped {
            background: linear-gradient(145deg, #e6f3ff, #f0f8ff);
        }

        .card-content {
            transition: opacity 0.2s ease;
        }

        .word {
            font-size: 2.5em;
            font-weight: bold;
            color: #8b0000;
            margin-bottom: 15px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .pronunciation {
            font-size: 1.1em;
            color: #4b0082;
            margin-bottom: 15px;
            font-style: italic;
            font-weight: bold;
        }

        .meaning {
            font-size: 1.3em;
            color: #2c1810;
            line-height: 1.5;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .example {
            font-size: 1em;
            color: #4b0082;
            font-style: italic;
            background: linear-gradient(145deg, #fff8dc, #f5f5dc);
            padding: 15px;
            border-radius: 12px;
            border-left: 4px solid #daa520;
            margin-bottom: 10px;
        }

        .chapter-info {
            font-size: 0.8em;
            color: #8b4513;
            padding: 5px 12px;
            background: rgba(255,215,0,0.2);
            border-radius: 15px;
            display: inline-block;
            border: 1px solid #daa520;
        }

        .pronounce-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 12px 20px;
            font-size: 1em;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255,107,107,0.3);
            width: 100%;
        }

        .pronounce-btn:active {
            transform: scale(0.95);
        }

        /* í€´ì¦ˆ ëª¨ë“œ */
        .quiz-card {
            background: linear-gradient(145deg, #e6f3ff, #f0f8ff);
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            padding: 25px 15px;
            margin: 15px 0;
            min-height: 400px;
            border: 3px solid #4169e1;
        }

        .quiz-question {
            font-size: 1.4em;
            color: #2c1810;
            margin-bottom: 20px;
            font-weight: bold;
            line-height: 1.4;
        }

        .quiz-word {
            font-size: 2.2em;
            color: #8b0000;
            font-weight: bold;
            margin: 15px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }

        .quiz-option {
            background: linear-gradient(145deg, #ffffff, #f8f8f8);
            border: 2px solid #ddd;
            border-radius: 15px;
            padding: 15px 20px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-weight: 500;
        }

        .quiz-option:active {
            transform: scale(0.98);
        }

        .quiz-option.correct {
            background: linear-gradient(45deg, #4CAF50, #66BB6A);
            color: white;
            border-color: #4CAF50;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .quiz-option.wrong {
            background: linear-gradient(45deg, #f44336, #e57373);
            color: white;
            border-color: #f44336;
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
        }

        .quiz-option.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        .quiz-feedback {
            margin: 15px 0;
            padding: 15px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.1em;
        }

        .feedback-correct {
            background: linear-gradient(145deg, #e8f5e8, #f1f8e9);
            color: #2e7d32;
            border: 2px solid #4CAF50;
        }

        .feedback-wrong {
            background: linear-gradient(145deg, #ffebee, #fce4ec);
            color: #c62828;
            border: 2px solid #f44336;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 20px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-primary {
            background: linear-gradient(45deg, #228b22, #32cd32);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #4169e1, #6495ed);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc143c, #ff6347);
            color: white;
        }

        .btn-quiz {
            background: linear-gradient(45deg, #9c27b0, #ba68c8);
            color: white;
            font-size: 1.2em;
            padding: 18px;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            background: rgba(255,215,0,0.2);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
            border: 2px solid #daa520;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 1.5em;
            font-weight: bold;
            display: block;
            color: #ffd700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .stat-label {
            font-size: 0.8em;
            color: #e6e6e6;
        }

        .final-score {
            background: linear-gradient(145deg, #ffd700, #ffed4e);
            color: #2c1810;
            padding: 20px;
            border-radius: 20px;
            margin: 20px 0;
            border: 3px solid #daa520;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .final-score h2 {
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .flip-hint {
            position: absolute;
            bottom: 10px;
            right: 15px;
            color: #8b4513;
            font-size: 0.8em;
            opacity: 0.7;
        }

        .hidden {
            display: none;
        }

        .quiz-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #666;
        }

        .magic-sparkle {
            position: fixed;
            color: #ffd700;
            font-size: 1.5em;
            animation: sparkle 2s infinite;
            pointer-events: none;
            z-index: 1000;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0.5) rotate(0deg); }
            50% { opacity: 1; transform: scale(1) rotate(180deg); }
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;
            z-index: 1000;
            animation: celebrate 1s ease-out;
        }

        @keyframes celebrate {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- PWA ì„¤ì¹˜ ë²„íŠ¼ -->
    <button id="installBtn" class="install-btn hidden" title="ì•± ì„¤ì¹˜í•˜ê¸°">ğŸ“±</button>

    <div class="container">
        <div class="header">
            <h1>âš¡ í•´ë¦¬í¬í„° ì˜ì–´ ë§ˆìŠ¤í„° ğŸª„</h1>
            <p class="subtitle">ë§ˆë²•ì‚¬ì˜ ëŒê³¼ í•¨ê»˜ ì˜ì–´ ì •ë³µí•˜ê¸°</p>
            <div class="mode-indicator" id="modeIndicator">ğŸ“š í•™ìŠµ ëª¨ë“œ</div>
        </div>

        <!-- í•™ìŠµ ëª¨ë“œ -->
        <div id="studyMode">
            <div class="progress">
                <div class="progress-bar" id="studyProgressBar">1/25</div>
            </div>

            <div class="study-card" id="studyCard" onclick="flipStudyCard()">
                <div class="card-content" id="studyCardContent">
                    <!-- ë‚´ìš©ì´ JavaScriptë¡œ ì±„ì›Œì§ -->
                </div>
                <div class="flip-hint">í„°ì¹˜í•´ì„œ ë’¤ì§‘ê¸° âš¡</div>
            </div>

            <div class="controls">
                <button class="btn pronounce-btn" onclick="event.stopPropagation(); pronounceWord()">ğŸ”Š ë°œìŒ ë“£ê¸°</button>
                <button class="btn btn-secondary" onclick="nextStudyCard()">ë‹¤ìŒ ë‹¨ì–´ â†’</button>
                <button class="btn btn-quiz" onclick="startQuiz()" id="startQuizBtn" style="display: none;">ğŸ¯ í€´ì¦ˆ ì‹œì‘í•˜ê¸°!</button>
            </div>

            <div class="stats">
                <div class="stat-item">
                    <span class="stat-number" id="currentStudyCard">1</span>
                    <span class="stat-label">í˜„ì¬</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="studiedCount">0</span>
                    <span class="stat-label">í•™ìŠµì™„ë£Œ</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="totalStudyCards">25</span>
                    <span class="stat-label">ì „ì²´</span>
                </div>
            </div>
        </div>

        <!-- í€´ì¦ˆ ëª¨ë“œ -->
        <div id="quizMode" class="hidden">
            <div class="progress">
                <div class="progress-bar" id="quizProgressBar">1/25</div>
            </div>

            <div class="quiz-card" id="quizCard">
                <div class="quiz-progress">
                    <span>ë¬¸ì œ <span id="currentQuizNumber">1</span>/25</span>
                    <span>ì •ë‹µë¥ : <span id="accuracy">0</span>%</span>
                </div>
                
                <div class="quiz-question" id="quizQuestion">
                    <!-- í€´ì¦ˆ ì§ˆë¬¸ì´ ì—¬ê¸°ì— ë“¤ì–´ê° -->
                </div>

                <div class="quiz-options" id="quizOptions">
                    <!-- ì„ íƒì§€ë“¤ì´ ì—¬ê¸°ì— ë“¤ì–´ê° -->
                </div>

                <div class="quiz-feedback hidden" id="quizFeedback">
                    <!-- í”¼ë“œë°±ì´ ì—¬ê¸°ì— ë“¤ì–´ê° -->
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-secondary" onclick="nextQuizQuestion()" id="nextQuizBtn" style="display: none;">ë‹¤ìŒ ë¬¸ì œ â†’</button>
                <button class="btn btn-primary" onclick="restartQuiz()">í€´ì¦ˆ ë‹¤ì‹œí•˜ê¸°</button>
                <button class="btn btn-danger" onclick="backToStudy()">í•™ìŠµ ëª¨ë“œë¡œ ëŒì•„ê°€ê¸°</button>
            </div>

            <div class="stats">
                <div class="stat-item">
                    <span class="stat-number" id="correctCount">0</span>
                    <span class="stat-label">ì •ë‹µ</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="wrongCount">0</span>
                    <span class="stat-label">ì˜¤ë‹µ</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="quizScore">0</span>
                    <span class="stat-label">ì ìˆ˜</span>
                </div>
            </div>
        </div>

        <!-- ìµœì¢… ê²°ê³¼ -->
        <div id="finalResult" class="hidden">
            <div class="final-score">
                <h2>ğŸ‰ í€´ì¦ˆ ì™„ë£Œ!</h2>
                <p id="finalScoreText"></p>
                <p id="finalMessage"></p>
            </div>
            
            <div class="controls">
                <button class="btn btn-quiz" onclick="restartQuiz()">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
                <button class="btn btn-secondary" onclick="backToStudy()">í•™ìŠµ ëª¨ë“œë¡œ ëŒì•„ê°€ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        const flashcards = [
            {
                word: "cupboard", pronunciation: "/ËˆkÊŒbÉ™rd/", meaning: "ì°¬ì¥, ë²½ì¥",
                example: "Harry lived in a cupboard under the stairs.", chapter: "1ì¥ - ì‚´ì•„ë‚¨ì€ ì•„ì´"
            },
            {
                word: "ordinary", pronunciation: "/ËˆÉ”ËrdÉ™neri/", meaning: "í‰ë²”í•œ, ë³´í†µì˜",
                example: "The Dursleys were proud of being perfectly ordinary.", chapter: "1ì¥ - ì‚´ì•„ë‚¨ì€ ì•„ì´"
            },
            {
                word: "tremendous", pronunciation: "/trÉªËˆmendÉ™s/", meaning: "ì—„ì²­ë‚œ, êµ‰ì¥í•œ",
                example: "There was a tremendous roar from the crowd.", chapter: "1ì¥ - ì‚´ì•„ë‚¨ì€ ì•„ì´"
            },
            {
                word: "peculiar", pronunciation: "/pÉªËˆkjuËljÉ™r/", meaning: "ì´ìƒí•œ, íŠ¹ì´í•œ",
                example: "Professor McGonagall looked rather peculiar.", chapter: "1ì¥ - ì‚´ì•„ë‚¨ì€ ì•„ì´"
            },
            {
                word: "bewildered", pronunciation: "/bÉªËˆwÉªldÉ™rd/", meaning: "ë‹¹í™©í•œ, ì–´ë¦¬ë‘¥ì ˆí•œ",
                example: "Harry looked bewildered at all the attention.", chapter: "2ì¥ - ì‚¬ë¼ì§„ ìœ ë¦¬"
            },
            {
                word: "enormous", pronunciation: "/ÉªËˆnÉ”ËrmÉ™s/", meaning: "ê±°ëŒ€í•œ, ë§‰ëŒ€í•œ",
                example: "Hagrid had enormous hands and feet.", chapter: "4ì¥ - ì—´ì‡ ì§€ê¸°"
            },
            {
                word: "magnificent", pronunciation: "/mÃ¦É¡ËˆnÉªfÉªsÉ™nt/", meaning: "ì¥ì—„í•œ, í›Œë¥­í•œ",
                example: "Hogwarts was a magnificent castle.", chapter: "5ì¥ - ëŒ€ê°ì„  ê³¨ëª©"
            },
            {
                word: "fascinating", pronunciation: "/ËˆfÃ¦sÉªneÉªtÉªÅ‹/", meaning: "ë§¤í˜¹ì ì¸, í¥ë¯¸ì§„ì§„í•œ",
                example: "The magical world was fascinating to Harry.", chapter: "5ì¥ - ëŒ€ê°ì„  ê³¨ëª©"
            },
            {
                word: "terrified", pronunciation: "/ËˆterÉªfaÉªd/", meaning: "ë¬´ì„œì›Œí•˜ëŠ”, ê²ì— ì§ˆë¦°",
                example: "Neville was terrified of Professor Snape.", chapter: "8ì¥ - í¬ì…˜ ë§ˆìŠ¤í„°"
            },
            {
                word: "brilliant", pronunciation: "/ËˆbrÉªljÉ™nt/", meaning: "ë›°ì–´ë‚œ, í›Œë¥­í•œ",
                example: "Hermione was brilliant at every subject.", chapter: "9ì¥ - í•œë°¤ì¤‘ì˜ ê²°íˆ¬"
            },
            {
                word: "mysterious", pronunciation: "/mÉªËˆstÉªriÉ™s/", meaning: "ì‹ ë¹„ë¡œìš´, ìˆ˜ìƒí•œ",
                example: "There was something mysterious about the third floor.", chapter: "9ì¥ - í•œë°¤ì¤‘ì˜ ê²°íˆ¬"
            },
            {
                word: "furious", pronunciation: "/ËˆfjÊŠriÉ™s/", meaning: "ë¶„ë…¸í•œ, ê²©ë…¸í•œ",
                example: "Professor McGonagall was furious with them.", chapter: "9ì¥ - í•œë°¤ì¤‘ì˜ ê²°íˆ¬"
            },
            {
                word: "desperate", pronunciation: "/ËˆdespÉ™rÉ™t/", meaning: "ì ˆë§ì ì¸, í•„ì‚¬ì ì¸",
                example: "Harry made a desperate grab for his wand.", chapter: "10ì¥ - í• ë¡œìœˆ"
            },
            {
                word: "suspicious", pronunciation: "/sÉ™ËˆspÉªÊƒÉ™s/", meaning: "ì˜ì‹¬ìŠ¤ëŸ¬ìš´, ìˆ˜ìƒí•œ",
                example: "Snape's behavior seemed very suspicious.", chapter: "11ì¥ - í€´ë””ì¹˜"
            },
            {
                word: "determined", pronunciation: "/dÉªËˆtÉœËrmÉªnd/", meaning: "ê²°ì‹¬í•œ, ë‹¨í˜¸í•œ",
                example: "Harry was determined to win the Quidditch match.", chapter: "11ì¥ - í€´ë””ì¹˜"
            },
            {
                word: "invisible", pronunciation: "/ÉªnËˆvÉªzÉ™bÉ™l/", meaning: "ë³´ì´ì§€ ì•ŠëŠ”, íˆ¬ëª…í•œ",
                example: "Harry put on the invisibility cloak.", chapter: "12ì¥ - ì—ë¦¬ì…€ì˜ ê±°ìš¸"
            },
            {
                word: "anxious", pronunciation: "/ËˆÃ¦Å‹kÊƒÉ™s/", meaning: "ê±±ì •í•˜ëŠ”, ë¶ˆì•ˆí•œ",
                example: "Harry felt anxious about the exams.", chapter: "14ì¥ - ë…¸ë²„íŠ¸"
            },
            {
                word: "forbidden", pronunciation: "/fÉ™rËˆbÉªdÉ™n/", meaning: "ê¸ˆì§€ëœ, í—ˆìš©ë˜ì§€ ì•Šì€",
                example: "They entered the Forbidden Forest.", chapter: "15ì¥ - ê¸ˆì§€ëœ ìˆ²"
            },
            {
                word: "horrified", pronunciation: "/ËˆhÉ”ËrÉªfaÉªd/", meaning: "ë”ì°í•´í•˜ëŠ”, ê³µí¬ì— ì§ˆë¦°",
                example: "Harry was horrified by what he saw.", chapter: "15ì¥ - ê¸ˆì§€ëœ ìˆ²"
            },
            {
                word: "dangerous", pronunciation: "/ËˆdeÉªndÊ’É™rÉ™s/", meaning: "ìœ„í—˜í•œ",
                example: "The three-headed dog was extremely dangerous.", chapter: "16ì¥ - í•¨ì •ë¬¸ì„ í†µê³¼í•˜ì—¬"
            },
            {
                word: "courage", pronunciation: "/ËˆkÉœËrÉªdÊ’/", meaning: "ìš©ê¸°, ìš©ê°í•¨",
                example: "It takes courage to stand up to enemies.", chapter: "16ì¥ - í•¨ì •ë¬¸ì„ í†µê³¼í•˜ì—¬"
            },
            {
                word: "protection", pronunciation: "/prÉ™ËˆtekÊƒÉ™n/", meaning: "ë³´í˜¸, ë³´í˜¸ë§‰",
                example: "His mother's love gave Harry protection.", chapter: "17ì¥ - ë‘ ì–¼êµ´ì„ ê°€ì§„ ë‚¨ì"
            },
            {
                word: "triumph", pronunciation: "/ËˆtraÉªÊŒmf/", meaning: "ìŠ¹ë¦¬, ì„±ê³µ",
                example: "Harry's triumph over Voldemort was celebrated.", chapter: "17ì¥ - ë‘ ì–¼êµ´ì„ ê°€ì§„ ë‚¨ì"
            },
            {
                word: "adventure", pronunciation: "/É™dËˆventÊƒÉ™r/", meaning: "ëª¨í—˜, ëª¨í—˜ë‹´",
                example: "Harry's first year was full of adventure.", chapter: "17ì¥ - ë‘ ì–¼êµ´ì„ ê°€ì§„ ë‚¨ì"
            },
            {
                word: "magical", pronunciation: "/ËˆmÃ¦dÊ’ÉªkÉ™l/", meaning: "ë§ˆë²•ì˜, ì‹ ë¹„ë¡œìš´",
                example: "The magical world was beyond Harry's imagination.", chapter: "ì „ì²´"
            }
        ];

        // PWA ê´€ë ¨ ë³€ìˆ˜ë“¤
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');

        // ìƒíƒœ ë³€ìˆ˜ë“¤
        let currentMode = 'study'; // 'study' ë˜ëŠ” 'quiz'
        let currentStudyIndex = 0;
        let isStudyFlipped = false;
        let studiedCards = 0;
        let allStudied = false;

        // í€´ì¦ˆ ê´€ë ¨ ë³€ìˆ˜ë“¤
        let currentQuizIndex = 0;
        let quizQuestions = [];
        let correctAnswers = 0;
        let wrongAnswers = 0;
        let isQuizAnswered = false;

        // PWA ì„¤ì¹˜ ê´€ë ¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.classList.remove('hidden');
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    console.log('ì•±ì´ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤');
                }
                deferredPrompt = null;
                installBtn.classList.add('hidden');
            }
        });

        // ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then((registration) => {
                        console.log('Service Worker ë“±ë¡ ì„±ê³µ:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
                    });
            });
        }

        // í•™ìŠµ ëª¨ë“œ í•¨ìˆ˜ë“¤
        function displayStudyCard() {
            const card = flashcards[currentStudyIndex];
            const cardContent = document.getElementById('studyCardContent');
            
            if (!isStudyFlipped) {
                cardContent.innerHTML = `
                    <div class="word">${card.word}</div>
                    <div class="pronunciation">${card.pronunciation}</div>
                `;
            } else {
                cardContent.innerHTML = `
                    <div class="meaning">${card.meaning}</div>
                    <div class="example">"${card.example}"</div>
                    <div class="chapter-info">ğŸ“– ${card.chapter}</div>
                `;
            }
            
            updateStudyProgress();
        }

        function flipStudyCard() {
            const studyCard = document.getElementById('studyCard');
            const cardContent = document.getElementById('studyCardContent');
            
            createSparkles();
            cardContent.style.opacity = '0';
            
            setTimeout(() => {
                isStudyFlipped = !isStudyFlipped;
                studyCard.classList.toggle('flipped', isStudyFlipped);
                displayStudyCard();
                cardContent.style.opacity = '1';
            }, 200);
        }

        function nextStudyCard() {
            if (!isStudyFlipped) {
                studiedCards++;
            }
            
            if (currentStudyIndex < flashcards.length - 1) {
                currentStudyIndex++;
                isStudyFlipped = false;
                document.getElementById('studyCard').classList.remove('flipped');
                displayStudyCard();
            } else {
                // ëª¨ë“  ì¹´ë“œ í•™ìŠµ ì™„ë£Œ
                allStudied = true;
                document.getElementById('startQuizBtn').style.display = 'block';
                createCelebration('ğŸ‰');
                
                setTimeout(() => {
                    alert('âš¡ ëª¨ë“  ë‹¨ì–´ í•™ìŠµ ì™„ë£Œ! ì´ì œ í€´ì¦ˆì— ë„ì „í•´ë³´ì„¸ìš”! ğŸª„');
                }, 500);
            }
        }

        function updateStudyProgress() {
            const progress = ((currentStudyIndex + 1) / flashcards.length) * 100;
            const progressBar = document.getElementById('studyProgressBar');
            progressBar.style.width = progress + '%';
            progressBar.textContent = `${currentStudyIndex + 1}/${flashcards.length}`;
            
            document.getElementById('currentStudyCard').textContent = currentStudyIndex + 1;
            document.getElementById('studiedCount').textContent = studiedCards;
        }

        // í€´ì¦ˆ ëª¨ë“œ í•¨ìˆ˜ë“¤
        function startQuiz() {
            if (!allStudied) {
                alert('ë¨¼ì € ëª¨ë“  ë‹¨ì–´ë¥¼ í•™ìŠµí•´ì£¼ì„¸ìš”!');
                return;
            }
            
            currentMode = 'quiz';
            document.getElementById('studyMode').classList.add('hidden');
            document.getElementById('quizMode').classList.remove('hidden');
            document.getElementById('finalResult').classList.add('hidden');
            document.getElementById('modeIndicator').textContent = 'ğŸ¯ í€´ì¦ˆ ëª¨ë“œ';
            
            generateQuizQuestions();
            currentQuizIndex = 0;
            correctAnswers = 0;
            wrongAnswers = 0;
            
            displayQuizQuestion();
        }

        function generateQuizQuestions() {
            quizQuestions = [];
            
            flashcards.forEach((card, index) => {
                // ëœ» ë§ì¶”ê¸° ë¬¸ì œ
                const meaningQuestion = {
                    type: 'meaning',
                    word: card.word,
                    correct: card.meaning,
                    question: `ë‹¤ìŒ ë‹¨ì–´ì˜ ëœ»ì€?`,
                    options: generateMeaningOptions(card.meaning, index)
                };
                
                // ë‹¨ì–´ ë§ì¶”ê¸° ë¬¸ì œ
                const wordQuestion = {
                    type: 'word',
                    meaning: card.meaning,
                    correct: card.word,
                    question: `ë‹¤ìŒ ëœ»ì— í•´ë‹¹í•˜ëŠ” ì˜ì–´ ë‹¨ì–´ëŠ”?`,
                    options: generateWordOptions(card.word, index)
                };
                
                quizQuestions.push(Math.random() > 0.5 ? meaningQuestion : wordQuestion);
            });
            
            // ë°°ì—´ ì„ê¸°
            quizQuestions = shuffleArray(quizQuestions);
        }

        function generateMeaningOptions(correctMeaning, correctIndex) {
            const options = [correctMeaning];
            const usedIndexes = [correctIndex];
            
            while (options.length < 4) {
                const randomIndex = Math.floor(Math.random() * flashcards.length);
                if (!usedIndexes.includes(randomIndex)) {
                    options.push(flashcards[randomIndex].meaning);
                    usedIndexes.push(randomIndex);
                }
            }
            
            return shuffleArray(options);
        }

        function generateWordOptions(correctWord, correctIndex) {
            const options = [correctWord];
            const usedIndexes = [correctIndex];
            
            while (options.length < 4) {
                const randomIndex = Math.floor(Math.random() * flashcards.length);
                if (!usedIndexes.includes(randomIndex)) {
                    options.push(flashcards[randomIndex].word);
                    usedIndexes.push(randomIndex);
                }
            }
            
            return shuffleArray(options);
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function displayQuizQuestion() {
            if (currentQuizIndex >= quizQuestions.length) {
                showFinalResult();
                return;
            }

            const question = quizQuestions[currentQuizIndex];
            const questionElement = document.getElementById('quizQuestion');
            const optionsElement = document.getElementById('quizOptions');
            const feedbackElement = document.getElementById('quizFeedback');
            
            // í”¼ë“œë°± ìˆ¨ê¸°ê¸°
            feedbackElement.classList.add('hidden');
            document.getElementById('nextQuizBtn').style.display = 'none';
            isQuizAnswered = false;
            
            // ì§ˆë¬¸ í‘œì‹œ
            if (question.type === 'meaning') {
                questionElement.innerHTML = `
                    <div>${question.question}</div>
                    <div class="quiz-word">${question.word}</div>
                `;
            } else {
                questionElement.innerHTML = `
                    <div>${question.question}</div>
                    <div style="font-size: 1.3em; color: #4b0082; margin: 15px 0; font-weight: bold;">"${question.meaning}"</div>
                `;
            }
            
            // ì„ íƒì§€ í‘œì‹œ
            optionsElement.innerHTML = '';
            question.options.forEach((option, index) => {
                const optionButton = document.createElement('button');
                optionButton.className = 'quiz-option';
                optionButton.textContent = option;
                optionButton.onclick = () => selectQuizOption(option, question.correct, optionButton);
                optionsElement.appendChild(optionButton);
            });
            
            updateQuizProgress();
        }

        function selectQuizOption(selected, correct, buttonElement) {
            if (isQuizAnswered) return;
            
            isQuizAnswered = true;
            const allOptions = document.querySelectorAll('.quiz-option');
            const feedbackElement = document.getElementById('quizFeedback');
            
            // ëª¨ë“  ì˜µì…˜ ë¹„í™œì„±í™”
            allOptions.forEach(option => {
                option.classList.add('disabled');
                if (option.textContent === correct) {
                    option.classList.add('correct');
                }
            });
            
            if (selected === correct) {
                correctAnswers++;
                buttonElement.classList.add('correct');
                feedbackElement.className = 'quiz-feedback feedback-correct';
                feedbackElement.innerHTML = `
                    <div>ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!</div>
                    <div style="margin-top: 8px; font-size: 0.9em;">${getWordDetails(correct)}</div>
                `;
                createCelebration('âœ¨');
            } else {
                wrongAnswers++;
                buttonElement.classList.add('wrong');
                feedbackElement.className = 'quiz-feedback feedback-wrong';
                feedbackElement.innerHTML = `
                    <div>âŒ í‹€ë ¸ìŠµë‹ˆë‹¤.</div>
                    <div style="margin-top: 8px; font-size: 0.9em;">ì •ë‹µ: <strong>${correct}</strong></div>
                    <div style="margin-top: 5px; font-size: 0.9em;">${getWordDetails(correct)}</div>
                `;
            }
            
            feedbackElement.classList.remove('hidden');
            document.getElementById('nextQuizBtn').style.display = 'block';
            
            updateQuizStats();
        }

        function getWordDetails(answer) {
            const card = flashcards.find(card => 
                card.word === answer || card.meaning === answer
            );
            
            if (card) {
                return `"${card.example}"`;
            }
            return '';
        }

        function nextQuizQuestion() {
            currentQuizIndex++;
            displayQuizQuestion();
        }

        function updateQuizProgress() {
            const progress = ((currentQuizIndex + 1) / quizQuestions.length) * 100;
            const progressBar = document.getElementById('quizProgressBar');
            progressBar.style.width = progress + '%';
            progressBar.textContent = `${currentQuizIndex + 1}/${quizQuestions.length}`;
            
            document.getElementById('currentQuizNumber').textContent = currentQuizIndex + 1;
            
            const accuracy = Math.round((correctAnswers / Math.max(correctAnswers + wrongAnswers, 1)) * 100);
            document.getElementById('accuracy').textContent = accuracy;
        }

        function updateQuizStats() {
            document.getElementById('correctCount').textContent = correctAnswers;
            document.getElementById('wrongCount').textContent = wrongAnswers;
            
            const score = Math.round((correctAnswers / quizQuestions.length) * 100);
            document.getElementById('quizScore').textContent = score;
        }

        function showFinalResult() {
            document.getElementById('quizMode').classList.add('hidden');
            document.getElementById('finalResult').classList.remove('hidden');
            
            const score = Math.round((correctAnswers / quizQuestions.length) * 100);
            const finalScoreText = document.getElementById('finalScoreText');
            const finalMessage = document.getElementById('finalMessage');
            
            finalScoreText.textContent = `${correctAnswers}/${quizQuestions.length} ì •ë‹µ (${score}ì )`;
            
            if (score >= 90) {
                finalMessage.textContent = 'âš¡ í•´ë¦¬í¬í„°ì²˜ëŸ¼ ë›°ì–´ë‚œ ë§ˆë²•ì‚¬ì…ë‹ˆë‹¤! ğŸª„';
                createMultipleSparkles();
            } else if (score >= 70) {
                finalMessage.textContent = 'ğŸ¦‰ í—¤ë“œìœ„ê·¸ë„ ì¸ì •í•  ì‹¤ë ¥ì´ì—ìš”! ğŸ“š';
            } else if (score >= 50) {
                finalMessage.textContent = 'ğŸ§™â€â™‚ï¸ ë” ì—´ì‹¬íˆ ê³µë¶€í•´ì„œ ë§ˆë²•ì‚¬ê°€ ë˜ì–´ë³´ì„¸ìš”!';
            } else {
                finalMessage.textContent = 'ğŸ“– ë‹¤ì‹œ í•™ìŠµí•˜ê³  ì¬ë„ì „í•´ë³´ì„¸ìš”!';
            }
        }

        function restartQuiz() {
            startQuiz();
        }

        function backToStudy() {
            currentMode = 'study';
            document.getElementById('studyMode').classList.remove('hidden');
            document.getElementById('quizMode').classList.add('hidden');
            document.getElementById('finalResult').classList.add('hidden');
            document.getElementById('modeIndicator').textContent = 'ğŸ“š í•™ìŠµ ëª¨ë“œ';
        }

        // ìŒì„± ì¬ìƒ í•¨ìˆ˜
        function pronounceWord() {
            const card = flashcards[currentStudyIndex];
            
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel(); // ì´ì „ ìŒì„± ì¤‘ë‹¨
                
                const utterance = new SpeechSynthesisUtterance(card.word);
                utterance.lang = 'en-GB'; // ì˜êµ­ì‹ ì˜ì–´ë¡œ ë³€ê²½
                utterance.rate = 0.7;
                utterance.pitch = 1.1; // ì—¬ì„± ìŒì„±ì„ ìœ„í•´ í”¼ì¹˜ ì•½ê°„ ë†’ì„
                
                const voices = speechSynthesis.getVoices();
                
                // ì˜êµ­ ì—¬ì„± ìŒì„± ìš°ì„  ê²€ìƒ‰
                let selectedVoice = voices.find(voice => 
                    voice.lang.includes('en-GB') && 
                    voice.name.toLowerCase().includes('female')
                );
                
                // ì˜êµ­ ì—¬ì„± ìŒì„±ì´ ì—†ìœ¼ë©´ ì˜êµ­ ìŒì„± ì¤‘ ì•„ë¬´ê±°ë‚˜
                if (!selectedVoice) {
                    selectedVoice = voices.find(voice => 
                        voice.lang.includes('en-GB') || 
                        voice.name.toLowerCase().includes('british') ||
                        voice.name.toLowerCase().includes('uk')
                    );
                }
                
                // ì˜êµ­ ìŒì„±ì´ ì•„ì˜ˆ ì—†ìœ¼ë©´ ì—¬ì„± ìŒì„± ì°¾ê¸°
                if (!selectedVoice) {
                    selectedVoice = voices.find(voice => 
                        voice.lang.startsWith('en') && 
                        (voice.name.toLowerCase().includes('female') ||
                         voice.name.toLowerCase().includes('woman') ||
                         voice.name.toLowerCase().includes('kate') ||
                         voice.name.toLowerCase().includes('susan') ||
                         voice.name.toLowerCase().includes('victoria'))
                    );
                }
                
                // ë§ˆì§€ë§‰ìœ¼ë¡œ ì•„ë¬´ ì˜ì–´ ìŒì„±ì´ë¼ë„
                if (!selectedVoice) {
                    selectedVoice = voices.find(voice => voice.lang.startsWith('en'));
                }
                
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                    console.log('ì„ íƒëœ ìŒì„±:', selectedVoice.name, selectedVoice.lang);
                }
                
                // í—¤ë¥´ë¯¸ì˜¨ëŠì²˜ëŸ¼ ë˜‘ë˜‘í•˜ê²Œ ë°œìŒí•˜ë„ë¡ ì„¤ì •
                utterance.volume = 0.9;
                
                speechSynthesis.speak(utterance);
                
                // ë°œìŒ ë²„íŠ¼ì— í”¼ë“œë°± íš¨ê³¼
                const pronounceBtn = document.querySelector('.pronounce-btn');
                if (pronounceBtn) {
                    pronounceBtn.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        pronounceBtn.style.transform = 'scale(1)';
                    }, 150);
                }
                
            } else {
                alert('ğŸ”Š ìŒì„± ì¬ìƒì´ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
            }
        }

        // ì‹œê° íš¨ê³¼ í•¨ìˆ˜ë“¤
        function createSparkles() {
            const sparkles = ['âœ¨', 'â­', 'ğŸŒŸ', 'ğŸ’«', 'âš¡'];
            
            for (let i = 0; i < 3; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'magic-sparkle';
                sparkle.textContent = sparkles[Math.floor(Math.random() * sparkles.length)];
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.top = Math.random() * 100 + '%';
                sparkle.style.animationDelay = Math.random() * 0.5 + 's';
                
                document.body.appendChild(sparkle);
                
                setTimeout(() => sparkle.remove(), 2000);
            }
        }

        function createCelebration(emoji) {
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            celebration.textContent = emoji;
            
            document.body.appendChild(celebration);
            
            setTimeout(() => celebration.remove(), 1000);
        }

        function createMultipleSparkles() {
            for (let i = 0; i < 10; i++) {
                setTimeout(() => createSparkles(), i * 200);
            }
        }

        // ìŒì„± ë¡œë“œ
        window.addEventListener('load', () => {
            if ('speechSynthesis' in window) {
                speechSynthesis.getVoices();
                
                // iOS Safariì—ì„œ ìŒì„± ë¡œë“œë¥¼ ìœ„í•œ ì¶”ê°€ ì²˜ë¦¬
                speechSynthesis.addEventListener('voiceschanged', () => {
                    speechSynthesis.getVoices();
                });
            }
        });

        // ì´ˆê¸°í™”
        displayStudyCard();
    </script>
</body>
</html>